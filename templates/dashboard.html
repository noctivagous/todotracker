{% extends "base_dashboard.html" %}

{% block title %}TodoTracker Dashboard{% endblock %}

{% block content %}
<!-- Header -->
<div class="mb-8">
    <h2 class="text-3xl font-bold mb-2">Multi-Project Server Manager</h2>
    <p class="text-muted-foreground">
        Monitor and manage all running TodoTracker instances across your projects.
        Each project automatically gets its own port (8070+).
    </p>
</div>

<!-- Statistics -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <calcite-card>
        <div class="flex items-center justify-between p-4">
            <div>
                <p class="text-color-2 text-sm font-medium">Total Servers</p>
                <p class="text-4xl font-bold mt-2">{{ total_servers }}</p>
            </div>
            <div class="text-5xl opacity-50">ğŸŒ</div>
        </div>
    </calcite-card>

    <calcite-card>
        <div class="flex items-center justify-between p-4">
            <div>
                <p class="text-color-2 text-sm font-medium">Running</p>
                <p class="text-4xl font-bold mt-2">{{ running_servers }}</p>
            </div>
            <div class="text-5xl opacity-50">âœ…</div>
        </div>
    </calcite-card>

    <calcite-card>
        <div class="flex items-center justify-between p-4">
            <div>
                <p class="text-color-2 text-sm font-medium">Port Range</p>
                <p class="text-2xl font-bold mt-2">8070 - 8170</p>
            </div>
            <div class="text-5xl opacity-50">ğŸ”Œ</div>
        </div>
    </calcite-card>
</div>

<!-- Server List -->
<calcite-card>
    <div slot="title">
        <h3 class="text-xl font-bold">Active TodoTracker Instances</h3>
    </div>

    {% if servers %}
    <div>
        {% for server in servers %}
        <div class="p-4 {% if not forloop.last %}border-b border-color-2{% endif %}">
            <div class="tt-surface p-6 {% if server.is_running %}border-l-4 border-l-green-500{% endif %} {% if not server.is_running %}opacity-70{% endif %}">
                <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-3 flex-wrap">
                            <h4 class="text-xl font-bold">{{ server.project_name }}</h4>
                            {% if server.is_running %}
                            <calcite-chip scale="s" appearance="solid" kind="brand">ğŸŸ¢ Running</calcite-chip>
                            {% else %}
                            <calcite-chip scale="s" appearance="solid" kind="danger">ğŸ”´ Offline</calcite-chip>
                            {% endif %}
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="text-color-2 mb-1">ğŸŒ Port</p>
                                <p class="font-mono text-lg font-bold">{{ server.port }}</p>
                            </div>
                            <div>
                                <p class="text-color-2 mb-1">â±ï¸ Uptime</p>
                                <p class="font-semibold">{{ server.uptime }}</p>
                            </div>
                            <div class="md:col-span-2">
                                <p class="text-color-2 mb-1">ğŸ’¾ Database</p>
                                <p class="font-mono text-xs text-color-2 break-all">{{ server.db_path }}</p>
                            </div>
                            <div>
                                <p class="text-color-2 mb-1">ğŸ”¢ Process ID</p>
                                <p class="font-mono">{{ server.pid }}</p>
                            </div>
                            <div>
                                <p class="text-color-2 mb-1">ğŸ• Started</p>
                                <p>{{ server.started_at[:19] }}</p>
                            </div>
                        </div>
                    </div>

                    {% if server.is_running %}
                    <div class="flex flex-col gap-2">
                        <calcite-button href="http://localhost:{{ server.port }}" target="_blank" appearance="solid" scale="s">
                            ğŸš€ Open Web UI
                        </calcite-button>
                        <calcite-button href="http://localhost:{{ server.port }}/docs" target="_blank" appearance="outline" scale="s">
                            ğŸ“š API Docs
                        </calcite-button>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center p-6">
        <div class="text-6xl mb-4">ğŸ“­</div>
        <h3 class="text-xl font-semibold mb-2">No Running Servers</h3>
        <p class="text-color-2 mb-6">Start a TodoTracker instance to see it here.</p>
        <calcite-card class="max-w-2xl mx-auto text-left">
            <p class="font-semibold mb-2">To start a TodoTracker server:</p>
            <pre class="tt-surface p-4 text-sm overflow-x-auto">cd /path/to/your/project
python /path/to/todotracker/todotracker_webserver.py</pre>
        </calcite-card>
    </div>
    {% endif %}
</calcite-card>

<!-- Info -->
<calcite-card class="mt-8">
    <div slot="title">
        <h3 class="text-lg font-semibold">â„¹ï¸ How It Works</h3>
    </div>
    <ul class="space-y-2 text-sm text-color-2 p-4">
        <li class="flex items-start"><span class="mr-2">â€¢</span><span><strong>Adaptive Ports:</strong> Each project automatically gets the next available port starting from 8070.</span></li>
        <li class="flex items-start"><span class="mr-2">â€¢</span><span><strong>No Conflicts:</strong> If port 8070 is in use, the system tries 8071, 8072, etc.</span></li>
        <li class="flex items-start"><span class="mr-2">â€¢</span><span><strong>Project Detection:</strong> Running the same project twice opens the existing server instead.</span></li>
        <li class="flex items-start"><span class="mr-2">â€¢</span><span><strong>Dashboard Port:</strong> This dashboard always runs on port <code class="tt-surface px-2 py-1 text-xs">8069</code> (reserved).</span></li>
        <li class="flex items-start"><span class="mr-2">â€¢</span><span><strong>Auto-Cleanup:</strong> Stale server entries are automatically removed.</span></li>
    </ul>
</calcite-card>

<!-- Quick Actions -->
<div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
    <calcite-card>
        <div slot="title">
            <h3 class="text-lg font-semibold">ğŸš€ Quick Start</h3>
        </div>
        <p class="text-sm text-color-2 mb-4 p-4">Launch a TodoTracker instance for your project:</p>
        <pre class="tt-surface p-4 text-sm overflow-x-auto m-4 mt-0">cd /path/to/your/project
./todos.sh</pre>
    </calcite-card>

    <calcite-card>
        <div slot="title">
            <h3 class="text-lg font-semibold">ğŸ“Š Dashboard Access</h3>
        </div>
        <p class="text-sm text-color-2 mb-4 p-4">Run the dashboard from anywhere:</p>
        <pre class="tt-surface p-4 text-sm overflow-x-auto m-4 mt-0">python /path/to/todotracker/dashboard.py</pre>
    </calcite-card>
</div>

<script>
    // Auto-refresh every 10 seconds
    setTimeout(function () {
        location.reload();
    }, 10000);
</script>
{% endblock %}

